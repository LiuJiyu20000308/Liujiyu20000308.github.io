---
layout: post
title: Higgs实习记录
date: 2025-3-6 10:00 +0800
tags: [实习记录]
toc: true
---

### 思考




### 技术

#### 多线程

线程是程序中的独立执行流，属于同一进程内的多个线程 **共享进程的内存空间**​（如全局变量、堆内存），但每个线程拥有 **独立的栈空间和执行上下文**​（如寄存器状态、程序计数器）。

**线程 vs 进程:**

| ​**特征**            | ​**进程**                                   | ​**线程**                                 |
|----------------------|--------------------------------------------|------------------------------------------|
| ​**资源分配**         | 操作系统资源分配的基本单位（独立内存空间） | 进程内的执行单元（共享进程内存）         |
| ​**切换开销**         | 高（涉及虚拟内存、文件描述符等切换）       | 低（仅切换栈和寄存器）                   |
| ​**创建销毁**         | 通过 `fork()` 创建，系统调用消耗大         | 通过 `pthread_create()` 创建，消耗小     |
| ​**独立性**           | 相互隔离，一个进程崩溃不影响其他进程       | 共享内存，一个线程崩溃可能导致整个进程终止 |
| ​**通信方式**         | 管道、消息队列、共享内存、Socket 等        | 直接读写共享变量（需同步机制）           |
| ​**CPU调度**          | 进程是 CPU 资源分配的基本单位               | 线程是 CPU 调度的基本单位                |




#### 数据对齐

内存对齐的核心规则
1. ​**成员对齐规则**：每个成员的起始地址必须是其自身大小的整数倍（例如 `int` 需4字节对齐，`double` 需8字节对齐）。
2. ​**结构体填充规则**：结构体总大小必须是其最大成员大小的整数倍。
3. ​**成员顺序影响**：成员顺序不同会导致填充字节的数量变化，进而影响总内存占用。

```cpp
struct TestA{
    char a;
    int b;
    char c;
    double d;
};
```

内存布局​（假设默认8字节对齐）：
- char a占1字节，偏移量0。
- int b需4字节对齐，因此在a后填充3字节（偏移量4-7）。
- char c占1字节，偏移量8。
- double d需8字节对齐，因此在c后填充7字节（偏移量16-23）。
- ​总大小：1+3（填充）+4+1+7（填充）+8 = ​24字节。

```cpp
struct TestB{
    char a;
    char c;
    int b;
    double d;
};
```

内存布局：
- char a和char c共占2字节，偏移量0-1。
- int b需4字节对齐，因此在c后填充2字节（偏移量4-7）。
- double d直接对齐到偏移量8（无需填充）。
- ​总大小：1+1+2（填充）+4+8 = ​16字节。

```cpp
struct TestC{
    char a;
    char c;
    double d;
    char b;
};
```

内存布局：
- char a和char c共占2字节，偏移量0-1。
- double d需8字节对齐，因此在c后填充6字节（偏移量8-15）。
- char b占1字节，偏移量16。
- 结构体总大小需是最大成员double的倍数（8字节），因此在b后填充7字节。
- ​总大小：1+1+6（填充）+8+1+7（填充） = ​24字节。
